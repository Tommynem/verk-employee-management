{% from "macros/_icons.html" import icon %}

<tr id="time-entry-row-{{ entry.id }}"
    class="{% if loop is defined and loop.index is even %}bg-base-200{% endif %} border-b border-base-300 cursor-pointer hover:bg-base-300/50 transition-colors"
    hx-get="/time-entries/{{ entry.id }}/edit-row"
    hx-target="closest tr"
    hx-swap="outerHTML"
    hx-trigger="click">
    {# 1. Tag (Date) #}
    <td class="py-3 px-4 text-sm">
        {{ entry.work_date.strftime('%d.%m.%y') }}
        {% if is_holiday %}
        <span class="ml-2 badge badge-warning badge-sm" title="{{ holiday_name }}">{{ icon("party-popper", class="w-3 h-3") }}</span>
        {% endif %}
    </td>

    {# 2. Ankunft (Start Time) #}
    <td class="py-3 px-4 text-sm">{{ entry.start_time.strftime('%H:%M') if entry.start_time else '' }}</td>

    {# 3. Ende (End Time) #}
    <td class="py-3 px-4 text-sm">{{ entry.end_time.strftime('%H:%M') if entry.end_time else '' }}</td>

    {# 4. Pausen (Break) #}
    <td class="py-3 px-4 text-sm">{{ entry.break_minutes|format_duration if entry.break_minutes else '' }}</td>

    {# 5. Arbeitsstunden Real (Actual Hours) #}
    <td class="py-3 px-4 text-sm bg-info/10">{{ actual_hours|format_hours if actual_hours else '' }}</td>

    {# 6. Arbeitsstunden Soll (Target Hours) #}
    <td class="py-3 px-4 text-sm">{{ target_hours|format_hours }}</td>

    {# 7. +/- (Balance) #}
    <td class="py-3 px-4 text-sm {% if balance >= 0 %}text-success{% else %}text-error{% endif %}">
        {{ balance|format_balance }}
    </td>

    {# 8. Abwesenheit / Bemerkung (Notes) #}
    <td class="py-3 px-4 text-sm text-base-content/70">{{ entry.notes or '' }}</td>

    {# 9. Quick Absence Buttons #}
    <td class="py-3 px-4 text-center" onclick="event.stopPropagation()">
        <div class="flex gap-1 justify-center">
            {# Urlaub (Vacation) #}
            <button type="button"
                    class="btn btn-xs btn-ghost {% if entry.absence_type.value == 'vacation' %}!bg-primary/30 !border-2 !border-primary !opacity-100{% else %}opacity-60 hover:opacity-100{% endif %}"
                    aria-label="Urlaub"
                    title="Urlaub"
                    hx-patch="/time-entries/{{ entry.id }}"
                    hx-vals='{"absence_type": "{% if entry.absence_type.value == 'vacation' %}none{% else %}vacation{% endif %}"}'
                    hx-target="closest tr"
                    hx-swap="outerHTML">
                {{ icon("umbrella", class="w-4 h-4") }}
            </button>

            {# Krank (Sick) #}
            <button type="button"
                    class="btn btn-xs btn-ghost {% if entry.absence_type.value == 'sick' %}!bg-error/30 !border-2 !border-error !opacity-100{% else %}opacity-60 hover:opacity-100{% endif %}"
                    aria-label="Krank"
                    title="Krank"
                    hx-patch="/time-entries/{{ entry.id }}"
                    hx-vals='{"absence_type": "{% if entry.absence_type.value == 'sick' %}none{% else %}sick{% endif %}"}'
                    hx-target="closest tr"
                    hx-swap="outerHTML">
                {{ icon("thermometer", class="w-4 h-4") }}
            </button>

            {# Feiertag (Holiday) #}
            <button type="button"
                    class="btn btn-xs btn-ghost {% if entry.absence_type.value == 'holiday' %}!bg-warning/30 !border-2 !border-warning !opacity-100{% else %}opacity-60 hover:opacity-100{% endif %}"
                    aria-label="Feiertag"
                    title="Feiertag"
                    hx-patch="/time-entries/{{ entry.id }}"
                    hx-vals='{"absence_type": "{% if entry.absence_type.value == 'holiday' %}none{% else %}holiday{% endif %}"}'
                    hx-target="closest tr"
                    hx-swap="outerHTML">
                {{ icon("party-popper", class="w-4 h-4") }}
            </button>

            {# Gleitzeit (Flex Time) #}
            <button type="button"
                    class="btn btn-xs btn-ghost {% if entry.absence_type.value == 'flex_time' %}!bg-info/30 !border-2 !border-info !opacity-100{% else %}opacity-60 hover:opacity-100{% endif %}"
                    aria-label="Gleitzeit"
                    title="Gleitzeit"
                    hx-patch="/time-entries/{{ entry.id }}"
                    hx-vals='{"absence_type": "{% if entry.absence_type.value == 'flex_time' %}none{% else %}flex_time{% endif %}"}'
                    hx-target="closest tr"
                    hx-swap="outerHTML">
                {{ icon("clock-arrow-down", class="w-4 h-4") }}
            </button>
        </div>
    </td>

    {# 10. Actions (Empty for view mode) #}
    <td class="py-3 px-4 w-12"></td>
</tr>
